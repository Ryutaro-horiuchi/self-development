# 状態遷移テストの概要

- 状態戦隊テストとは、「状態遷移図を用いたテスト」や「状態遷移表を用いたテスト」の総称
- ソフトウェアの動作中に様々に変化する「状態」に着目する
    - 状態遷移とは
        - ある状態が別の状態へ変化すること
    - 状態遷移のきっかけとなる操作や条件のこと
        - イベント

# 状態遷移図と状態遷移表

![IMG_5877.jpeg](attachment:a2d611f2-6e17-4f3a-9882-1afe11b9c4db:IMG_5877.jpeg)

## 画面遷移と状態遷移

- 画面(状態)の洗い出しと、遷移するためのイベントを定義するという観点で、状態遷移テストと変わりはない

## 状態とは

- 概念
    - 一定の同じ動作を続けている様子
    - 動作後に異なる動作を開始しない様子
- 詳しく見ると、3種類
    - 部位の状態
        - ソフトウェアシステムが搭載された機器の部位の状態のこと。「スイッチの状態 ON / OFF」など
    - 処理の状態
        - ソフトウェアにおける処理状態のこと。「計測中」や「データ読み込み中」　など
    - モードの状態
        - ソフトウェアシステムが搭載された機器全体の状態のこと。「ストップウォッチ 計測中 /  処理中 / 停止中」など

## メリット

- 状態遷移図
    - 状態遷移の流れを容易に把握できる
    - 図示することによって新たな発見がある
        - 「どこにも遷移しない状態」や「複数の異なる状態に遷移するイベント」などの不備が見つかる
- 状態遷移表
    - 仕様が曖昧な箇所に潜む欠陥を見つけることができる
    - 状態遷移図の不備を見つけることができる

# 状態遷移図の作り方

- 開発仕様書から「状態」と「イベント」を抽出する
    - ある**「状態」で「イベント」が起きると、別の状態へ「遷移」する**という関係
- 表記方法
    
    ![IMG_5878.jpeg](attachment:87fd3a16-0d02-4b83-880a-3d8f080fb361:IMG_5878.jpeg)
    
- 例
    
    ![IMG_5879.jpeg](attachment:3ac8b448-149a-4418-9f06-6e6cb3930d0b:IMG_5879.jpeg)
    
    - イベントは人の手によるものだけでないことに留意する

## 状態遷移図を見やすくするコツ

- 状態遷移図を機能ごとに分割すると見やすくなる
    
    ![IMG_5880.jpeg](attachment:f2e473ca-aa44-4095-b444-f9feac25513b:b240acfc-2aec-4c63-b35f-9766e0b21b33.png)
    

## 状態遷移図を用いたテスト

- 状態遷移図をもとにテストケースを書いていく。作成する際は、3つのポイントに注目する
    - 全ての状態を1回は通る
    - 全てのイベントを1回は発生させる
    - 全ての遷移を1回は通る

### コピー機の例

- 仕様
    - 状態とイベント
        
        ![IMG_5912.jpeg](attachment:7eb28d17-3e9f-4bad-90c7-a004ec9dafcc:IMG_5912.jpeg)
        
    - 状態遷移図
        
        ![IMG_5913.jpeg](attachment:2c2444cb-4424-4082-8b94-d29e672e21e0:IMG_5913.jpeg)
        
- テストケース1 「全ての状態を1回は通る」
    
    ![IMG_5914.jpeg](attachment:20dc2437-2877-44a6-968e-123bc2793456:IMG_5914.jpeg)
    
- テストケース2 「全てのイベントを1回は発生させる」
    
    ![IMG_5915.jpeg](attachment:887da3c4-03ca-4ce1-81ba-96f6aeefe514:IMG_5915.jpeg)
    
- テストケース3  「全ての遷移を1回は通る」
    
    ![IMG_5916.jpeg](attachment:37f03a05-a535-4d4e-8354-2bf501fadb11:IMG_5916.jpeg)
    
- テストケース3が一番多いので優れているように見えるが、テストケース2で定義されていた一部のイベントのケースが含まれていない

<aside>
💡

それぞれの特徴を理解した上で、段階的にそれぞれのテストケースをテストすることが必要

</aside>

### 状態遷移図の目的

- 仕様を図に書き起こすことが状態遷移図を作成する目的ではない
- 作成する際に再度、状態遷移の仕様に漏れや抜けがないかを確認することが大切

### 状態遷移図だけでは不十分

- 状態遷移図は「できること」を表す方法だが、「できないはずのこと」が本当にできないかを確認する必要がある。
    - 状態遷移図は仕様書に書かれていることを図に書き起こすため、「できること」を書いているに過ぎない。そのため、状態遷移図だけでは不十分である

## 状態遷移表

- 縦軸に状態、横軸にイベントを書いていく
- Ex.
    
    
    |  | コピー開始ボタン押下 | 停止ボタン押下 | コピーが終わる |
    | --- | --- | --- | --- |
    | 停止中 | コピー中 | ー | ー |
    | コピー中 | ー | 停止中 | 停止中 |
    - 「停止中」の時に、『コピー開始ボタンを押下する』と、「コピー中」に遷移する
    - 「ー」はイベントが発生してもどこにも遷移しないことを表す
- 「状態×状態」の遷移表もあるが、最初に行う状態とイベントの抽出が不十分だと状態遷移に漏れが生じる可能性があるため、「状態×イベント」のフォーマットを本書では推奨

### 起こり得ないイベントと遷移

- どこにも遷移しないイベントを「ー」　と表記してきたが、「N/A」という表記を使用することもある

| 表記 | 説明 |
| --- | --- |
| ー | 発生しても処理が起きないように実装されたイベント |
| N/A | 発生させることができないイベント。起こり得ないイベント |

### 状態遷移表を用いたテスト

- 1つのマス目を1つのテストケースとみなす
- Ex.
    - 状態遷移表
        
        
        |  | EJECTボタンを押す | CDを入れる | PLAY・PAUSEボタンを押す | STOPボタンを押す |
        | --- | --- | --- | --- | --- |
        | 停止(CDなし) | ー | 停止(CDあり) | ー | ー |
        | 停止(CDあり) | 停止(CDなし) | N/A | 再生中 | ー |
        | 再生中 | 停止(CDなし) | N/A | 一時停止中 | 停止(CDあり) |
        | 一時停止中 | 停止(CDなし) | N/A | 再生中 | 停止(CDあり) |
        - 優先順位に従って、以下の順番でテストケースを実施する
            - 状態遷移が起きるテストケース
            - 「ー」のテストケース
            - 「N/A」のテストケース
    - テストケース
        
        ![IMG_5911.jpeg](attachment:c1ac6752-b507-4d6b-9287-48370e53a809:IMG_5911.jpeg)