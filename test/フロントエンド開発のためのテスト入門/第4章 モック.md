# モックの用語整理

「取得したデータの代用品」として登場するのがモック(テストダブル)

モックはスタブとスパイに分かれる

## スタブ

- 目的
    
    「代用」を行うこと
    
    - Ex. 依存コンポーネントの代用品、定められた値を返却する、テスト対象に入力を与えるためのもの
    - 単体テスト、結合テストを行うにあたり、未実装や都合の悪いモジュールを置き換えることで、テスト不能だった対象のテストが実施可能になる

## スパイ

- 目的
    - 「記録」を行うこと
        - Ex. 関数やメソッドの呼び出しを記録するオブジェクト、呼び出された回数や実行時の引数を記録するもの、テスト対象からの出力を確認するもの

## モックモジュールを使ったスタブ

Jestの、`jest.mock()`を使用する

### 基本

- テスト対象の関数
    
    ```jsx
    export function greet(name: string) {
      return `Hello! ${name}.`;
    }
    
    // 未実装で都合の悪いモジュールと想定
    export function sayGoodBye(name: string) {
      throw new Error("未実装");
    }
    ```
    
- 正常に動作するモジュール(greet関数)を置き換える
    
    → 置き換えられているため、undefinedがかえる
    
    ```jsx
    import { greet } from "./greet";
    
    jest.mock("./greet");
    
    test("挨拶を返さない（本来の実装ではない）", () => {
      expect(greet("Taro")).toBe(undefined);
    });
    ```
    
- 都合の悪いモジュール(sayGoodBye関数)を置き換える
    - 置き換えられているため、テストが通る
    
    ```jsx
    import { greet, sayGoodBye } from "./greet";
    
    jest.mock("./greet", () => ({
      sayGoodBye: (name: string) => `Good bye, ${name}.`,
    }));
    
    test("挨拶を返さない（本来の実装ではない）", () => {
      ...
    });
    
    test("さよならを返す（本来の実装ではない）", () => {
      const message = `${sayGoodBye("Taro")} See you.`;
      expect(message).toBe("Good bye, Taro. See you.");
    });
    ```
    
- モジュールの一部をスタブに置き換える
    - `jest.requireActual`を使用する
    - 一部を置き換えたため、greetも通るようになった
    
    ```jsx
    import { greet, sayGoodBye } from "./greet";
    
    jest.mock("./greet", () => ({
      ...jest.requireActual("./greet"),
      sayGoodBye: (name: string) => `Good bye, ${name}.`,
    }));
    
    test("挨拶を返す（本来の実装どおり）", () => {
      expect(greet("Taro")).toBe("Hello! Taro.");
    });
    
    test("さよならを返す（本来の実装ではない）", () => {
      const message = `${sayGoodBye("Taro")} See you.`;
      expect(message).toBe("Good bye, Taro. See you.");
    });
    ```