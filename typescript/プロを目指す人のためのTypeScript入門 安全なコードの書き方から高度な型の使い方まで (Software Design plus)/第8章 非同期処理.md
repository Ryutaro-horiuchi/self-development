## 非同期処理とは

- 下記いずれか、あるいはその両方を特徴として持つ
    - 裏で行われる処理
    - 時間がかかる処理

## シングルスレッドモデル・ノンブロッキング

- 時間のかかる処理をプログラムから行う場合、そのAPIはブロッキングなものとノンブロッキングなもの2種類に分かれる
    - ブロッキングな処理は、その処理が完了するまでプログラムがそこで停止する処理
        
        ↔ ノンブロッキング
        
        - JavaScript・TypeScriptでは非同期処理はノンブロッキングなものである
- JavaScript・TypeScriptでは、実行モデルとしてシングルスレッドなモデル(プログラムが並列に実行されることはない)が採用されている
    - 通信の処理中に他のことができるのは通信自体はOSがおこなっているものであり、JavaScriptがシングルスレッドというのは、あくまでアプリケーションロジックが描かれたJavaScriptプログラム部分が並列に実行されないことを指す

### 同期処理と非同期処理の順序

- 同期的に実行中のプログラムに非同期処理が割り込むことはない
- 同期的な処理が全部終了してからコールバック関数が実行される

## Promise

### Promiseの型

- Ex.
    
    ```tsx
    import { readFile } from "fs/promises";
    
    const p = readFile("foo.txt", "utf8");
    // pの型 Promise<string>
    ```
    
- Promiseオブジェクトは`Promise<T>`という型を持つ
    - 型引数を一つ持ち今回のPromise<string>は、string型の結果をもつPromiseオブジェクト

### Promiseの非同期処理タイミング

- PromiseベースのAPIの場合実際に非同期処理が始まるのはどのタイミングか？
    
    → 非同期処理を呼び出した瞬間に始まっており、Promiseオブジェクトが返り値として返された段階ですでに始まっている
    

### catch時の型

- catchに渡されたコールバック関数や、thenの第二引数に渡されたコールバック関数の引数の型は型推論だとany型である
    - 歴史的経緯からany型が使われている。unknown型の注釈をつけることを著者は推奨
    
    ```tsx
    import { readFile } from "fs/promises";
    
    const p = readFile("foo.txt", "utf8");
    
    p.then((result) => {
      console.log("成功", result);
    });
    p.catch((error) => { // errorはany型
      console.log("失敗", error);
    });
    
    // p.catch(error: unknown) => 
    ```
    

p360

Promiseの静的メソッド