## composablesディレクトリ

- auto-imortが行われるディレクトリ
    - composables/ディレクトリ配下に設定されたファイルが自動的にインポートされる

## useState

- Nuxt は、コンポーネント間でリアクティブかつ SSR 対応の共有状態を作成するための [**`useState`**](https://nuxt.com/docs/4.x/api/composables/use-state)composable を提供
- 使用方法
    
    ```jsx
    // Create a reactive state and set default value
    const count = useState('counter', () => Math.round(Math.random() * 100))
    
    ```
    

### 型

```tsx
export function useState<T> (init?: () => T | Ref<T>): Ref<T>
export function useState<T> (key: string, init?: () => T | Ref<T>): Ref<T>
```

- key: データ取得時にリクエスト間で重複排除を適切に行うための固有キー。キーを指定しない場合、useStateのインスタンスのファイル名と行番号に固有のキーが生成されます。
- init: 初期化されていない状態の初期値を提供する関数。この関数はRefを返すこともできます
- T: (TypeScriptのみ) 状態の型を指定します

### 非同期データでの初期化

callOnceユーティリティを備えたapp.vueコンポーネントで使用できる

- app.vue
    
    ```jsx
    <script setup lang="ts">
    const websiteConfig = useState('config')
    
    await callOnce(async () => {
      websiteConfig.value = await $fetch('https://my-cms.com/api/website-config')
    })
    </script>
    
    ```
    

### Stateを使用する

- 自動インポートされたコンポーザブルを使用することで、使用できる
- Ex.
    - composables/states.ts
        
        ```tsx
        export const useColor = () => useState<string>('color', () => 'pink')
        
        ```
        
    - app/app.vue
        
        ```tsx
        <script setup lang="ts">
        const color = useColor()
        // Same as useState('color')
        </script>
        
        <template>
          <p>Current color: {{ color }}</p>
        </template>
        
        ```
        

### Piniaでの状態管理例

- app/stores/website.ts
    
    ```tsx
    export const useWebsiteStore = defineStore('websiteStore', {
      state: () => ({
        name: '',
        description: '',
      }),
      actions: {
        async fetch () {
          const infos = await $fetch('https://api.nuxt.com/modules/pinia')
    
          this.name = infos.name
          this.description = infos.description
        },
      },
    })
    
    ```
    
- app/app.vue
    
    ```tsx
    <script setup lang="ts">
    const website = useWebsiteStore()
    
    await callOnce(website.fetch)
    </script>
    
    <template>
      <main>
        <h1>{{ website.name }}</h1>
        <p>{{ website.description }}</p>
      </main>
    </template>
    
    ```
    

[第11章 Pinia](https://www.notion.so/11-Pinia-a4a6c8339b524739b82675fce37de457?pvs=21) 

## アクションを使う例

- composables/index.ts
    
    ```tsx
    import { Ref } from "vue"
    export const useTitle = () => {
      const title = useState<string>('title', ()=>  "Hello World!")
      const changeTitle = (title: Ref<string>) => (value: string) => {
        title.value = value
      }
      return {
        title: readonly(title),
        changeTitle: changeTitle(title)
      }
    }
    ```
    
- app.vue
    
    ```tsx
    <template>
      <div>
        <h1>{{ title }}</h1>
        <button @click="$event => titleState.changeTitle('Hello Nuxt3!')">
          changeTitle
        </button>
      </div>
    </template>
    
    <script setup>
     const titleState = useTitle()
     const { title } = titleState
    </script>
    
    ```