## はじめに

- キーバリューストア
    - 各々固有の識別子をキーとしてキーに関連づけられた値を格納する
    - キー
        - 一意である
        - プレーンテキストでもハッシュ化された値でも可能だが、パフォーマンス上の理由から短いキーが効果的
    - 値
        - 文字列、リスト、オブジェクトが使用可能

## 単一サーバーのキーバリューストア

- 1台のサーバーに置かれたキーバリューストアの開発は簡単ではあるが、容量的な制約から、全てをメモリに格納することは困難
    - 2つの最適化が可能
        - データ圧縮
        - 使用頻度の高いデータのみをメモリに保存し、残りはディスクに保存する

## 分散型キーバリューストア

- キーバリューペアを多数のサーバーに分散して配置する
- 分散システムを設計する場合、CAP定理の理解が重要になる

### CAP定理

一貫性、可用性、分割耐性からなり、同時に保証するのは不可能であるとされている

- 一貫性
    - どのノードに接続しても、すべてのクライアントが同じデータを同時に見られる
- 可用性
    - 一部のノードがダウンしても、レスポンスを得られる
- 分断耐性
    - 2つのノードで通信が途絶えていても(ネットワークの分断)、システムが動作し続けること
- 2つのCAP特性によって分類 p107
    
    

### 実世界の分散システム

- ネットワークの分断が発生した場合、一貫性と可用性のどちらかを選択しなければならない
- Ex. 図6-3 n3がダウン　p108
    - n1, n2にデータが書き込まれた場合はn3にはデータが伝搬しない(逆も然り)
    - 可用性より一貫性を選ぶ(CPシステム)
        - これら3つのサーバー間でのデータの不整合を避けるために、n1とn2の書き込み操作をすべてブロックする必要がある → システムが利用できなくなる
    - 一貫性より可用性を選ぶ(APシステム)
        - システムは古いデータを返す必要があるが、読み込みを受け付ける
        - n1とn2は書き込みを受け続け、ネットワークの分断が解除された時点でn3にデータが同期される

## システム構成要素

キーバリューストアを構築するために使用するコアとなる構成要素とテクニックの説明。Dynamo, Casssandra, BigTableに基づいている

### データの分割

- 大規模なアプリケーションの場合、データを小さなパーティションに分割し、複数のサーバーに格納する