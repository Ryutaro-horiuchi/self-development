## 正規化の功罪

---

データの整合性を保持するための正規化にも副作用がある

<aside>
💡 正規化されたテーブル群に対するSQLが非常に遅くなってしまう

</aside>

### 実例 (正規化と検索クエリ)

- 正規化の場合
    
    ![IMG_1414.jpeg](https://prod-files-secure.s3.us-west-2.amazonaws.com/42b16988-a5a8-437d-af8b-c8412ee1342b/c50efd0c-dcc4-4822-a895-f147072c1c5f/38780542-1b01-479c-abab-84e8fdbc7c67.png)
    
    - 要望
        1. 田島さんが勤めている会社と部署名を取得したい
            - SQL
                
                ```sql
                SELECT 会社.会社名, 社員.社員名
                  FROM 社員 INNER JOIN 会社
                            ON 社員.会社コード = 会社.会社コード
                WHERE 社員.社員名 = '田島';
                
                ```
                
                - 内部結合して取得する必要がある
        2. 会社ごとに何人在籍しているか集計する
            - SQL
                
                ```sql
                
                SELECT 会社.会社コード, COUNT (社員.社員名) AS 社員数
                  FROM 会社 LEFT OUTER JOIN 社員
                            ON 社員.会社コード = 会社.会社コード
                 GROUP BY 会社.会社コード;
                ```
                
                外部結合して取得する必要がある
                
- 非正規化の場合
    
    ![IMG_1415.jpeg](https://prod-files-secure.s3.us-west-2.amazonaws.com/42b16988-a5a8-437d-af8b-c8412ee1342b/11cbba63-e9b2-4136-a5f8-c8d795e3dd3b/81645977-eb08-4eae-8af0-640680b81eb9.png)
    
    - 田島さんが勤めている会社と部署名を取得したい
        - SQL
            
            ```sql
            SELECT 会社名,社員名,部署名
              FROM 社員
             WHERE 社員名 = '田島';
            ```
            
- 非正規化の方がSQLがシンプルであり、結合を利用しないため、パフォーマンスが良い

p145

正規化されたテーブルでは、単独では必ずしもユーザーの欲しがる情報をカバーできず、結合が伴う。結合するテーブル数、レコード数が増えるほど、処理に時間がかかる

検索処理に関しては、非正規化に分配が上がる

p146

非正規化であれば、SQLで結合を使わずに済む。パフォーマンスも良い

p147

更新処理に関しては、正規化に分配が上がる

データの整合性とパフォーマンスがトレードオフ

p148

非正規化は最後の手段

p156

冗長に保持すると正規系に違反するが、反して検索を高速化できる

可能な限り高次にすることが原則

p157

非正規化のリスク

- 更新時のパフォーマンス

p159

論理設計には物理設計の知識が必要になる