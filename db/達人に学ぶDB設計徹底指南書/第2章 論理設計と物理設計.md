# 概念スキーマと論理設計

- 概念スキーマを定義する設計を**論理設計**と呼ぶ
    - 一般的な意味の論理ではなく、「物理層の制約にとらわれない」という意味
    - 「物理層の制約にとらわれない」とは、DBサーバーのCPUやストレージのデータの格納場所、DBMSのSQLの構文といった具体的な実装レベルの条件は一旦無視するということ
- DB設計の手順
    - 概念スキーマ(論理設計) → 内部スキーマ(物理設計) の手順で設計を行う

## 論理設計のステップ

---

### 1. エンティティの抽出

- システムためにどのようなエンティティが必要になるかを抽出する
- エンティティは日本語で「実体」DBの文脈では物理的な実体に加えて、概念的な存在も含まれる
- Ex.
    - 物理的なエンティティ「顧客」「社員」「店舗」
    - 概念的なエンティティ 「税」「会社」「注文履歴」

### 2. エンティティの定義

- エンティティがどのようなデータを保持するかを決める
    - キーという列も定義する
- エンティティはデータを属性という形で保持する。二次元表における「列」と同義

### 3. 正規化

- 更新が整合的に行えるように、エンティティのフォーマットを整理する

### 4. ER図の作成

- エンティティ同士の関係を表現する図を作成する

<aside>
💡 論理設計の段階では具体的なハードウェアやDBMSのミドルウェアをインストールする必要がない。→ 論理設計は机上で行えると考えて良い

</aside>

# 内部スキーマと物理設計

## 物理設計のステップ

---

### 1. テーブル定義

- 論理設計で定義された概念スキーマを元に、DBMS内部に格納するための「テーブル」の単位に変換していく作業
- 物理モデルと呼ばれる
    - 補足: 論理設計で作られるERモデルは論理モデル

### 2. インデックス定義

- パフォーマンスの調整

### 3. ハードウェアのサイジング

サイジングは二つの意味がある

1. キャパシティ 「データの規模」
    1. システムで利用するデータサイズを見積り、それに十分な容量の記憶装置(ストレージ)を選定する
    - 必要な入力情報
        1. システムで利用するデータ量
        2. サービス終了時のデータ増加率
            1. ほとんどのシステムでは、サービスの開始時よりもデータ量は増えるため、運用終了時にデータ量がどの程度になるか見越しておかないと、途中でストレージの容量が足らないという重大な問題が起こる
            2. ただ、終了時のデータ量を正確に見積もるのはむずかしいため、二つのアプローチをとる
                1. 安全率を大きく取って、余裕を持たせたサイジング
                2. 仮に後で容量が不足した場合に、簡単に記憶装置を追加できるような構成にしておく
2. パフォーマンス 「処理性能」
    1. システムが十分な性能を発揮できるだけのスペックのCPUやメモリを持ったサーバーを選定する
    2. ストレージも絡んでくる。
        1. ディスク回転数など性能を決めるスペックがあるため。
        2. 性能問題のほとんどは、ストレージのI/Oネックによって引き起こされる
            - I/O: 「Input/Output(入出力)」の略でデータの読み込み（入力）と書き込み（出力）の操作のこと
    3. データの整合性とパフォーマンスの間に強いトレードオフが存在する
        1. 整合性を高くしようとするとパフォーマンスが犠牲になり、パフォーマンスを追求すると整合成を犠牲にする
    - 必要な入力情報
        1. 性能要件
            - 通常、システム開発では性能要件を二つの指標を使って定義する
                1. 処理時間
                    1. 特定の処理について「何秒以内に終了すること」といった形で定義する
                2. スループット
                    1. 特定の時間内にどれだけの処理をこなせるか
                    2. 単位で「1秒あたりの仕事量」を示すTPSという指標を使うのが一般的
        2. リソース使用量の基礎数値
            - どの程度の処理を行うと、どの程度のハードウェアリソースを消費するのか。根拠となる基礎数値を得る必要がある
                1. 類似の稼働中システムのデータを流用する
                2. プロトタイプシステムを構築して、性能検証を実施する
                    
                    → 予算とスケジュールに余裕があるプロジェクトでないと難しいため、キャパシティのサイジングと同様、スケーラビリティに留意したサイジングを行う必要がある
                    

## ストレージの冗長構成