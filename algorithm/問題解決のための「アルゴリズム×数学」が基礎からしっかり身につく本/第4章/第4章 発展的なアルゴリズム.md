# 4.1 コンピューターで図形問題を ~ 計算幾何学
## ベクトルとは

- 2つの点の相対的な位置関係を表す時に利用される
- 2次元のベクトルの場合は**成分表記**を用いて(X座標の差、Y座標の差)という形で表現できる

### ベクトルの表記

- 例えば点Sの座標が(1,1)、点Tの座標が(8,3)のとき、点Sから点Tへ向かうベクトルの**成分表示**は(7,2)となる

![IMG_4467.jpeg](attachment:65d68e11-17ae-46a4-8335-3077db7d4ec8:IMG_4467.jpeg)

### 大きさと向きの両方が等しい時に、「同じベクトルである」と言える

![IMG_4468.jpeg](attachment:61812dab-06e7-419c-9fde-2d91cbd9ffdc:IMG_4468.jpeg)

### ベクトルの足し算・引き算

![IMG_4470.jpeg](attachment:ac40c20d-1c5d-48d4-b945-dc4fbdce6ff3:IMG_4470.jpeg)

### ベクトルの大きさ

![IMG_4471.jpeg](attachment:3c77381e-b64e-49e5-94d3-036bdc7aa684:IMG_4471.jpeg)

### ベクトルの内積

![IMG_4472.jpeg](attachment:e058b21f-7a36-4b59-abe7-c53cb3933868:IMG_4472.jpeg)

![IMG_4473.jpeg](attachment:aeae3824-7d91-437f-a886-dc4d8c41c188:IMG_4473.jpeg)

- 内積が0であれば2つのベクトルは垂直
- 正であれば2つのベクトルのなす角は90度より小さい
- 負であれば90度より大きい

### ベクトルの外積

![IMG_4474.jpeg](attachment:ca6c3c28-3448-4203-b86c-79763eb207c1:d0bcaac5-492e-41f5-b8cb-647d594a1732.png)

例題: 点と線分の距離

- 問題
    
    ![image.png](attachment:a083a127-bc33-41a2-8aa0-e8282e4ed952:image.png)
    
- 用語
    - 垂線
        - 線分に対して垂直になるようにおろした直線のこと
    - 垂線の足
        - 垂線と線分の交点のこと
- 考え方
    - 点と線分の位置関係に応じて、以下の3つのパターンに場合わけをする
    - どのパターンに当てはまるかは、[ベクトルの内積](https://www.notion.so/1c693db055548021aa3fed7765a4ee37?pvs=21) のない席と角度の関係を使用する
        
        ![IMG_4475.jpeg](attachment:b8d3ae5e-751d-4533-87ae-4ad6f5533b16:IMG_4475.jpeg)
        
        - パターン1 は、点Aとは線分BCのBと最も近くなるため、答えはAB間の距離
        - パターン3 は、点Aとは線分BCのCと最も近くなるため、答えはAC間の距離
        - パターン2
            - 点Aから線分BC上におろした垂線の足を点Hとすると、点Aとは線分BCのHと最も近くなる。答えはAH間の距離
            - AHの求め方
                - 平行四辺形を考える
                    
                    ![IMG_4476.jpeg](attachment:c1c7397f-2c74-4a19-8e0a-5aeb458994a6:IMG_4476.jpeg)
                    
                    - 平行四辺形の面積は「底辺 × 高さ 」
                        - 底辺の長さは線分BC
                        - 高さはAH間の距離
                    - [ベクトルの外積](https://www.notion.so/1c693db0555480a98d42d4d3f3d47650?pvs=21) の性質1より、面積SはBA,BCの外積の大きさと等しい
                        - BA, BCの外積(面積) ÷ 線分BCで求めることができる
                            - 線分BCの求め方は[ベクトルの大きさ](https://www.notion.so/1c693db05554809891f8f94706fb04b6?pvs=21) で求めることができる
                - イメージ
                    
                    ![IMG_4477.jpeg](attachment:0f02c6b3-1400-4e28-ac53-9dd22c48cac8:IMG_4477.jpeg)
                    
                - コード
                    
                    ```python
                    from math import sqrt
                    
                    vector = {}
                    keys = ['a', 'b', 'c']
                    for i in range(3):
                      x, y = map(int, input().split())
                      vector[keys[i]] = {'x': x, 'y': y}
                    
                    # ベクトル BA, BC, CA, CBの成分表示を求める
                    BAx, BAy = vector['a']['x'] - vector['b']['x'], vector['a']['y'] - vector['b']['y']
                    BCx, BCy = vector['c']['x'] - vector['b']['x'], vector['c']['y'] - vector['b']['y']
                    CAx, CAy = vector['a']['x'] - vector['c']['x'], vector['a']['y'] - vector['c']['y']
                    CBx, CBy = vector['b']['x'] - vector['c']['x'], vector['b']['y'] - vector['c']['y']
                    
                    # どのパターンに当てはまるかを判定する
                    pattern = 2
                    if (BAx * BCx + BAy * BCy) < 0: pattern = 1
                    if (CAx * CBx + CAy * CBy) < 0: pattern = 3
                    
                    # 点と直線の距離を求める
                    if pattern == 1:
                      answer = sqrt(BAx**2 + BAy**2)
                    elif pattern == 3:
                      answer = sqrt(CAx**2 + CAy**2)
                    elif pattern == 2:
                      S = abs(BAx*BCy - BAy*BCx)
                      bc = sqrt(BCx**2 + BCy**2)
                      answer = S / bc
                    
                    print(answer)
                    
                    ```

- 節末問題
    4.1.1
    1. 
        A = 4.472135… ⭕️
        B = 9.486832 ⭕️
        A+B = (5,-5) ❌ 5√2
    2. 
        -30 ⭕️
    3. 
        大きい ⭕️
    4. 
        30 ⭕️


## コラム4 三角関数

<aside>
💡

節末問題4.1.4を解く上で必要

</aside>

### 三角比

- sin, cos, tanのようなものを三角比と呼ぶ
- 二次平面上で原点を中心とする半径1の円とx軸の正の部分を反時計回りにθだけ回転させた線」との交点との座標を(cosθ, sinθ)と表す
    
    ![IMG_4668.jpeg](attachment:c8281ae4-f182-4c7a-a38f-eea562407776:IMG_4668.jpeg)
    
- sinθをcosθで割った値をtanθとし、座標(0,0)と(cosθ, sinθ)を結ぶ直線の傾きを表す
    
    ![IMG_4669.jpeg](attachment:de7f2359-4be0-44df-b362-a235444b44eb:IMG_4669.jpeg)
    
- 別説明
    - サイン
        - 直角三角形における三角比のひとつで、斜辺に対する高さの比
        - sinθ = (高さ) / (底辺)
    - コサイン
        - 直角三角形における三角比のひとつで、斜辺に対する底辺の比
        - cosθ＝（底辺）/（斜辺）
    - タンジェント
        - 直角三角形における三角比のひとつで、底辺に対する高さの比
    - 三角比の覚え方
        
        ![image.png](attachment:f17d7787-75cd-440b-817b-bec0b9c95b94:image.png)
        
    - 三角比の基本
        
        ![image.png](attachment:30263b4f-fe10-4c13-814e-6ac04d5b149b:image.png)
        

### 弧度法

- 半径と弧の長さの比で角度を表す方法。単位はラジアンだが、書かない方法もある。
- 度数法で表された角度にπ/180をかけると、単位を「°」からradに変換することができる

### 三角関数

- `y = sin x`、　`y = cos x`、 `y = tan x` を三角関数と呼ぶ
- pythonでは、math.sin(x)、math.cos(x)、math.tan(x)を用いて求めることができる
- この時、xはラジアンである必要があるため、x * π/180をかける必要がある


# 4.2 階差と累積和
## 階差と累積和のアイデア

- 階差と累積和は互いに逆の操作になっている
    
    整数A₁, A₂, …, Aɴに対し、階差Bᵢ = Aᵢ - Aᵢ ₋ ₁を考える
    
    整数A₁, A₂, …, Aɴに対し、累積和Bᵢ = A₁ + A₂ + … + Aᵢ を考える
    
- イメージ
    
    ![IMG_4755.jpeg](attachment:6931674b-6943-4c88-a80d-ea8e9faab08d:IMG_4755.jpeg)
    
- 階差は直接計算してもO(N)で求められるが、累積和を計算すると計算量がO(N²)になってしまう
    - 累積和が階差の逆であることを使って、以下の順序で計算を行うと、計算量がO(N)で累積和を求められる
        
        <aside>
        💡
        
        - B₁ = A₁とする
        - 次にi=1,2,3, …, Nの順に、Bᵢ  = Bᵢ ₋ ₁ + Aᵢ とする
        </aside>
        
        [3, 1, 4, 1, 5, 9]の累積和を求める
        
        ![IMG_4756.jpeg](attachment:ce247d2a-c1d1-40ae-9244-8d8e229ffe30:IMG_4756.jpeg)
        

### 例題1: 来場者数を計算する

- 問題
    
    ![image.png](attachment:50687288-0051-4e2b-930f-e84a1756c2dc:image.png)
    
- 答えを直接計算する方法だと、1回の計算で最大N個の足し算を行う × Q日数分行うので計算量はO(NQ)となり、1秒以内に実行を終えることはできない
- x日目からy日目までの来場者数を求めるには、y日までの合計来場者数からx-1日までの合計来場者数を引くことで求められる。
    - 計算量はO(N + Q)で正しい答えを導き出せる

### 例題2: 降雪のシミュレーション

- 問題
    
    ![image.png](attachment:465d0061-7b56-44e6-bfd8-b5fc9e07c673:image.png)
    
- 区画iの現在の積雪Aᵢ を配列にメモして、Aᵢ を加算していく方法は、各日について最大N回の計算を行うのが、Q日間続くため、計算量はO(NQ)となり、1秒以内に実行を終えることができない
- 階差を使う
    - Ex. 2から5の区画まで雪が4cm降ったとする
        - 累積和 [0,4,4,4,4,0,0,0]
            - これを階差に変換すると、[0,4,0,0,0,-4,0,0]となる。つまり、2から5までの区画が降った場合、階差を求めるには、2の区画(B₂)をx増やし、5+1(B₆)の区画をx減少させる
                
                <aside>
                💡
                
                lからrまでの区画がxcm雪が降った場合、lの区画をx増やし、r+1の区画を減少させる
                
                </aside>
                
    - 大小関係は、Bᵢ ₊ ₁ > 0かどうかで判断することができる

# 4.3 ニュートン法 ~数値計算をやってみよう~
## 微分のイメージ

- ある点における「関数の傾きのようなもの」を求める操作を微分という
- y = x²のグラフにおけるx = 1付近の傾き
    
    ![IMG_4781.jpeg](attachment:5d3a2251-b2f5-4484-b6d0-c9bcd2d55ea4:IMG_4781.jpeg)
    

## 接線と微分係数

![IMG_4782.jpeg](attachment:ff2b9e24-7af8-4b7d-90d8-1aff391a9690:IMG_4782.jpeg)

- 接線と微分係数の関係
    - 関数y  = f(x) のグラフと点(a, f(a))で接する直線のことを接線という。
        - 関数と接線は、接するが交わらないのが特徴
    - イメージ
        
        ![IMG_4783.jpeg](attachment:22bad018-4e02-4d9a-a462-42d3fbd80b6a:IMG_4783.jpeg)
        
    
    <aside>
    💡
    
    - 点(a, f(a))における接線の傾きが、微分係数f’(a)と一致するという性質がある
        - f(x) = x² 上の点(1, 1)における接線の傾きは2だが、この値はf’(1) = 2と等しい
    </aside>
    

## いろいろな関数の微分

### 一次関数の微分

- f(x) = ax + b の傾きはどの点でもaであるため、全ての実数xについてf’(x) = aである

### 一般の多項式関数([多項式関数](https://www.notion.so/19b93db0555480dbaa1fd7eaa77736dd?pvs=21)) の微分

<aside>
💡

- f(x)の全ての項を自分の次数で掛けた後、次数を1減らした関数をf(x)とする
- x = t における微分係数はf’(t)である
</aside>

- イメージ
    
    ![IMG_4784.jpeg](attachment:4a2260d2-2d47-49a1-a085-0f84094a79fa:IMG_4784.jpeg)
    

### より厳密な微分の定義

![IMG_4785.jpeg](attachment:db7687f2-c613-45f9-9284-9abc1f27a5ec:IMG_4785.jpeg)

## ニュートン法で√2を求める

- √2の近似値は以下の方法で求められる
    
    ![IMG_4794.jpeg](attachment:77a87b40-7515-4a41-a250-c10046e7509c:IMG_4794.jpeg)
    
- Ex. 初期値を2とする
    
    ![IMG_4795.jpeg](attachment:451878bb-b926-47f7-bd23-0e84bb54612f:IMG_4795.jpeg)
    
    ![IMG_4796.jpeg](attachment:5a6cc0d4-e051-45d2-b7d3-26aa971e4304:IMG_4796.jpeg)
    

- 点と傾きがわかっている時、直線の傾きは点傾き形式で書ける
    
    ![image.png](attachment:e86bcd91-7b05-4b4b-aade-a3665a6019c0:image.png)
    
    - 点傾き形式の説明
        - 傾きはそもそも2点間の変化の比である
            
            ![image.png](attachment:9ef3181d-0ff0-4f5b-9492-3cb4af9f309f:image.png)
            
        - この式は直線上の任意の点(x,y)と、通る点(x1, y1)を繋いだときの傾き
        - この式を変形すると、下記の計算式となる
        
        ![image.png](attachment:25b496f4-6884-4a6a-8204-5d1471540858:image.png)
        

### ニュートン法の般化

![IMG_4797.jpeg](attachment:ef57c3d7-74dc-4af6-81a4-6198eabb83cd:IMG_4797.jpeg)

- 節末問題
    - 4.3.1 ⭕️
        1. 7
        2. 2x + 4
        3. 5xの4乗 + 4xの3乗 + 3xの2乗 + 2x + 1

## エラトステネスのふるいとは

- N以下の素数を列挙する方法で効率の良い方法
    
    ![IMG_4800.jpeg](attachment:a5e4d326-e59b-4b38-8cd9-2ffc126ab2ed:IMG_4800.jpeg)
    
- 計算量はO(N log log N)である
    - なぜこのような計算量になるのかは積分の知識が必要
- イメージ
    
    ![IMG_4801.jpeg](attachment:437f02d6-6967-4633-9509-52f073c2743e:IMG_4801.jpeg)
    
    ![IMG_4802.jpeg](attachment:aeb05403-826c-4fef-a0f3-149fe96f24db:IMG_4802.jpeg)
    

## 積分のイメージ

- 関数から得られる領域の面積を求める操作を積分という
- 積分には、不定積分と定積分の2種類があるが、本書では定積分のみ扱う
- 定積分の式
    
    ![IMG_4803.jpeg](attachment:f5a230c6-9e2b-4cc2-8eb6-ecf347ef0d8e:IMG_4803.jpeg)
    
    - 関数f(x)をaからbまで積分する
    - イメージ
        
        ![IMG_4804.jpeg](attachment:5b0314cf-d3fd-4e8e-9c92-33cd3d93768a:IMG_4804.jpeg)
        
- Ex.
    
    
    ![IMG_4805.jpeg](attachment:f351a7e1-91bf-4b16-93a3-f40ab4ba1541:IMG_4805.jpeg)
    
    これは3つの直線x = 3, x = 5, y = 0と関数 y = 4で囲まれた、下のグラフの色のついた部分の面積を求めることを意味する
    
    ![IMG_4806.jpeg](attachment:1e919021-7517-4412-a435-74f1deff7211:IMG_4806.jpeg)
    
- Ex2.
    
    
    ![IMG_4807.jpeg](attachment:b1f6c88d-cdd4-414d-8ab5-34d07e06d16e:IMG_4807.jpeg)
    
    x = 0, x = 5, y = 0, y = x-2で囲まれた、下図の面積を求めることを意味する
    
    積分は符号付き面積に対応するため、負方向に出ている部分はマイナスとする。従って求める定積分の値は以下のとおりである
    
    ![IMG_4808.jpeg](attachment:1903ffb2-f215-4eda-9322-fba87963196c:IMG_4808.jpeg)
    

## いろいろな関数の定積分

### 多項式関数の定積分

- 以下のステップでaからbまでの積分を求められる
    
    ![IMG_4812.jpeg](attachment:6c40867b-c19b-4388-a600-b90891d02a73:IMG_4812.jpeg)
    
- Ex.
    
    ![IMG_4813.jpeg](attachment:7b88e32c-b168-4bd2-94e3-62af4b692119:IMG_4813.jpeg)
    

### 1 / x の積分

![IMG_4814.jpeg](attachment:c99c978b-d9d6-44f0-a192-fccda746d192:IMG_4814.jpeg)

[公式](https://www.notion.so/19e93db055548019ba03dfd756c9b8e6?pvs=21)