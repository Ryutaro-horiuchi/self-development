## データフォーマット

- 世の中のデファクトスタンダードはJSONであるため、原則JSONとし、必要があればXMLを検討する

### JSONがXMLより優れている点

- データサイズが小さい
- JavaScriptとの相性が良い
- シンプル

### XMLがJSONより優れている点

- スキーマ定義の仕様がきちんと決まっている
- 要素に対して属性が付けられる
    
    <aside>
    💡 → 現在のWebAPIでやり取りされているデータは、キーバリュー形式や配列を使って表現するものがほとんどであり、XMLを使わなければならない状況はほとんどない
    
    </aside>
    

### データフォーマットの指定方法

- 一般的には以下のような方法が使われている
    - クエリパラメーターを使う方法
        
        ```
        https://api.example.com/v1/users?format=xml
        ```
        
    - 拡張子を使う方法
        
        ```
        https://api.example.com/v1/users.jsoGE
        ```
        
    - Acceptリクエストヘッダでメディアタイプを指定する方法
        
        ```
        GET /v1/users
        Host: api.example.com
        Accept: application/json
        ```
        
- 実際のAPIでよく使われているのはクエリパラメーター

## JSOAP

- JSON with paddingの略
- JSONにラップするJavaScriptを付け加えたもの
    
    ```jsx
    // サーバー側
    callback({”id”: 123, “name”: “Saeed”})
    
    // URI
    <script src="https://api.example.com/v1/users?callback=callback">
    ```
    
- 上記だとデータを読み込めれた際にcallback関数が呼び出される

### JSOAPがある背景

- XMLHTTPRequestでは、同一のドメインにしかアクセスできない(同一性制限ポリシー規制)
- スクリプトタグに含まれると、上記の規制の対象外であるため異なるドメインからデータを取得することが可能になる
    - → 動的に要素を生成して使用されることが一般的(?)

### JSOAPを指定するURI

- クエリパラメーターにコールバック関数の指定があればJSOAPとしてみなすのが一般的
- Content-Typeヘッダにセットするメディアタイプはapplication/jsonではなく、application/javascriptになる

### エラー処理

- サーバーがエラーを返した際に正しく識別されない問題点がある
- script要素はサーバー400番台で返してもクライアント側では何が起こったのかわからない
    - JSOAPを使用する場合は常に200番台で返し、レスポンスボディでエラーの内容を表現することでこれに対応する
        
        ```jsx
        {
        	status_code: 404,
        	error_message: "User Not Found"
        	
        }
        ```
        

## データの内部構造の考え方

- APIで返すレスポンスデータを返す際にまず考えるべきことは、APIのアクセス回数がなるべく減るようにすること
    - → ユースケースをきちんと考える必要が出てくる
- データーベースのインターフェースではなく、アプリケーションインターフェースであり、利用者が使いやすい構造を検討する
    - Ex. 内部的にはそのデータを返すのに関連テーブルから取り出す必要がある
        - 関連テーブルだからといって、度外視するのはDBのインターフェース
        - 関連テーブルではあるが、ユーザーにとって必要な情報であると考え、レスポンスに組み込むのはアプリケーションインターフェース
- Chatty(おしゃべり)なAPIにはならないようにする
    - Chatty なAPIとは一つの作業を完結するのに複数回のアクセスを必要とするようなAPIの設計のこと
    - ユースケースを考え、できる限り少ないアクセスで済むAPIを心がけるべき