## ビジネスルール

- コンピュータで実装されているかどうかに関わらず、ビジネスマネーを生み出したり節約したりするルールや手続きのこと
- ビジネスにとって欠かせない・システムが自動化されていなくても存在する、ルールのことを「最重要ビジネスルール」と呼ぶ。
    - Ex. 銀行がローンにN%の利子をつけているとすると、それは銀行のお金を産むためのビジネスルールになる。利子をコンピューターで計算しようと、そろばんで計算しようと、全く関係ない
- 最重要ビジネスルールに必要なデータのことを「最重要ビジネスデータ」と呼ぶ
    - Ex. ローンであれば、貸付残高、金利、支払いスケジュール

## エンティティ

- コンピューターシステムの内部にあるオブジェクトであり、最重要ビジネスデータを操作する最重要ビジネスルールをいくつか含んだもの
- Ex.  ローンクラス
    
    ```mermaid
    classDiagram
      direction TB
      class Loan {
        - principle
        - rate
        - period
        + makePayment()
        + applyInterest()
        + chargeLateFee()
      }
    ```
    
    - こうしたクラスを作成するときは、ビジネスにとって不可欠な概念を実装するソフトウェアをまとめ、これから構築するシステムから切り離すようにする
    - エンティティは、DB、ユーザーインターフェイスなどについて、何も気にする必要はない。エンティティはビジネスであり、それ以外の何者でもない

## ユースケース

- 自動化されたシステムを使用する方法を記述したものである
- エンティティに含まれる最重要ビジネスルールとは違い、アプリケーション固有のビジネスルールを記述している
    - エンティティの最重要ビジネスルールをいつ・どのように呼び出すかを規定したルールが含まれている
    - システムのユーザーに対する見た目を記述するものではなく、ユーザーとエンティティのインタラクションを支配するアプリケーション固有のルールを記述したもの
        - Ex.
            - 最重要ビジネスルール
                - 新規ローンを作成する際、銀行員はクライアントの連絡先を収集・検証してから、候補者の与信スコアが500以上あることを確認するまで、ローンの支払い見積もりを提示しない
            - ユースケース
                
                ![IMG_4033.jpeg](attachment:73d8e8ce-1152-4204-a03a-47883a4636bb:IMG_4033.jpeg)
                
                - ユーザーインターフェイスについては記述していない。ユースケースを見ただけでは、そのアプリケーションがウェブなのか、コンソールなのか、判断することは不可能である
        
- ユースケースはオブジェクトである。アプリケーション固有のビジネスルールを実装した関数を1つ以上持っている
    - エンティティは自身を制御するユースケースのことを知らない
    - 上位レベルのコンセプト(エンティティ)は、下位レベルのコンセプト(ユースケース)を知らない。
        - ユースケースはアプリケーション固有であり、システムの入力・出力に近いため、エンティティよりも下位レベルとなる
    

## リクエストとレスポンスモデル

- ユースケースをうまく作りたければ、ユースケースクラスのコードがHTMLやSQLなど、データの通信方法について触れるべきではない
    - ユースケースクラスは、入力としてシンプルなリクエストデータ構造を受け取り、出力としてシンプルなレスポンスデータ構造を戻す。
        - これらの構造はHttpRequestやHttpResponseといった、フレームワークのインターフェイスから派生したものではない。

## まとめ

ビジネスルールは、ソフトウェアが存在する理由である。ビジネスルールはシステムの中で、最も独立していて、最も再利用可能なコードでなければならない