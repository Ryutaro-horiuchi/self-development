どのクラスをどのコンポーネントに含めれば良いか。その考え方について取り上げられている

## 再利用・リリース等価の原則(RIP)

- 再利用可能なソフトウェアコンポーネントは、再リリース単位としても管理されるべきである
    - 再利用可能なソフトウェアの部品（モジュール、パッケージ、ライブラリ）は、一貫性のある形でリリースされるべき
        - 例えば、あるライブラリを利用する際に、そのライブラリ全体が単一のリリースバージョンとして管理されていると、依存関係の管理やアップデートが容易になる
- ソフトウェアの変更やバグ修正が行われた場合、再利用可能な単位としてリリースされることで、利用者は新しいバージョンを容易に取り入れることができる
    - バージョン番号（セマンティックバージョニングなど）を活用して変更の範囲や互換性を明確にすることが推奨
- 再利用可能なコンポーネントは、他のコンポーネントから独立しており、単独で利用可能でなければならない
    - 依存関係が明確で最小限に抑えられていることで、コンポーネントの再利用性が向上します。
    
    <aside>
    💡
    
    コンポーネントを形成するクラスやモジュールは凝集性のあるグループでなければならない
    
    </aside>
    

## 閉鎖性共通の原則(CCP)

> 同じ理由、同じタイミングで変更されるクラスをコンポーネントにまとめること。変更の理由やタイミングが異なるクラスは、別のコンポーネントに分けること
> 
- 単一責任の原則(SRP)をコンポーネント向けに言い換えたもの
    - SRP: 「クラスを変更する理由が複数あるべきではない」
    - CCP: 「コンポーネントを変更する理由が複数あるべきではない」
    
    <aside>
    💡
    
    どちらも共通して「同じ理由で変更するものはひとまとめにすること。変更のタイミングや理由が異なるものは別々に分けること」ということを言っている
    
    </aside>
    
- CCPが伝えたいこと
    - 「同じタイミングで変更されることが多いクラスは一つにまとめておけ」ということ
        - 2つのクラスが密結合していて、変更のタイミングがいつも一緒であれば、それは同じコンポーネントに属するものとみなせる
- CCPに従いすぎると、モジュールが大きくなりすぎてしまう可能性がある。
- 「閉鎖性共通の原則」の「閉鎖」は、オープン・クローズドの原則(OCP)の「クローズド」と同じ意味

## 全再利用の原則(CRP)

> コンポーネントのユーザーに対して、実際には使わないものへの依存を強要してはいけない
> 
- 一緒に用いられるクラスやモジュールは同じコンポーネントにまとめよという考え
- 全再利用の原則は、どのクラスをひとまとめにすべきではないかを伝える原則でもある
    - コンポーネントに属するクラスは、多くの依存関係があるはず
        - 仮にコンポーネントAとコンポーネントBがあり、コンポーネントAがコンポーネントBの中にある一つのクラスだけを使いたいとする
            - この状態ではコンポーネントBのアップデートがあった場合、コンポーネントAが使いたいクラスでなくてもAの更新 or 再コンパイルとデプロイが必要になる
    
    <aside>
    💡
    
    コンポーネントに依存するのであれば、コンポーネントに含まれる全てのクラスに依存するようにしておきたい
    
    </aside>
    
- CRPはインターフェイス分離の原則を一般化したものである。どちらも「不要なものには依存しないこと」ということを伝えている

## コンポーネント凝集性のテンション図

### それぞれの原則の立ち位置

- 再利用・リリース等価の原則(REP)と閉鎖性共通の原則(CCP)はコンポーネントを大きくする方向に働くもの
- 全再利用の原則(CRP)は、コンポーネントを小さくする方向に働くもの
    
    → これら3つの原則のバランスをうまく取るのが、アーキテクトの腕の見せ所
    

### テンション図

![IMG_3669.jpeg](https://prod-files-secure.s3.us-west-2.amazonaws.com/42b16988-a5a8-437d-af8b-c8412ee1342b/80e8f36c-6cdb-4417-8ffb-b1155a4face2/IMG_3669.jpeg)

- REP CRPを守ることだけに力を入れると、些細な変更が大量のコンポーネントに影響を及ぼすことになる
- REPとCCPに注目すると、リリースの回数が無駄に増えてしまう
- 優れたアーキテクトは、以下を知っている
    - この三角形の中で開発チームの現在の懸念事項に見合った落とし所を見つける
    - 時間がたてば懸念事項が変わる
        - 例えば初期段階は、REPよりもCCPの方が重要である。再利用性よりも、開発のしやすさが重要であるため
- 一般的にプロジェクトの初期は、この三角形の右側に位置する傾向にある。
    - プロジェクトが進み、別のプロジェクトから利用される頃になると、左側に移っていく。
        - そのプロジェクトの開発よりも、他のプロジェクトでの開発でどのように使われるのかを考えるようになるため

## まとめ

- どのクラスをコンポーネントにまとめるかを考えるときには、開発時の利便性と再利用性のトレードオフを考慮する必要がある
- また最適な落とし所は常に変わり続ける