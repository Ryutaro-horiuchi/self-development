- 以下よりフレーム句を見ておく
    
    [ウインドウ関数とは](https://www.notion.so/3701bfe5a4b143339d42374026f7684a?pvs=21) 
    
- 同じ行の列同士の値を比較するには、WHERE句で事足りるが、ある行と別の行とで列同士を比較するにはウインドウ関数や、相関サブクエリを用いる

## ウインドウ関数を用いると、非破壊的に行間比較を行える

- Ex. ある会社の年商を記録するテーブルから、前年と比較して増えたのか、減ったのか、変わらないのかをSQLで出力する
- テーブル: Sales(年商)
    
    
    | year(年度) | sale(億円) |
    | --- | --- |
    | 1990 | 50 |
    | 1991 | 51 |
    | 1992 | 52 |
    | 1993 | 52 |
    | 1994 | 50 |
- 前年と年商が同じ年度を求める
    - SQL: 相関サブクエリ
        
        ```sql
        -- 前年と年商が同じ年度を求める：その1 相関サブクエリの利用
        SELECT year,sale
          FROM Sales S1
         WHERE sale = (SELECT sale
                         FROM Sales S2
                        WHERE S2.year = S1.year - 1)
         ORDER BY year;
        
        ```
        
    - SQL: ウインドウ関数
        
        ```sql
        -- 前年と年商が同じ年度を求める：その2 ウインドウ関数の利用
        SELECT year, current_sale
          FROM (SELECT year,
                       sale AS current_sale,
                       SUM(sale) OVER (ORDER BY year
                                       RANGE BETWEEN 1 PRECEDING
                                                 AND 1 PRECEDING) AS pre_sale
                  FROM Sales) TMP
         WHERE current_sale = pre_sale
         ORDER BY year;
        ```
        
        - ウインドウ関数のみを抽出
            
            ```sql
            SELECT year, sale AS current_sale,
             SUM(sale) OVER (ORDER BY year
                             RANGE BETWEEN 1 PRECEDING
                                       AND 1 PRECEDING) AS pre_sale
            ```
            
            - `RANGE BETWEEN 1 PRECEDING AND 1 PRECEDING`を使用して、現在の行から一行前までに対象を絞っている(フレーム句) = 前年の行。
        - 相関サブクエリと比較して、元のテーブルを変更せず、新たな列を付け加えてた結果を返しているのみ
            - → 非破壊的とも呼べる