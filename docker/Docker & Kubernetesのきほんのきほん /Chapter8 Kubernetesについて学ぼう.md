# kubernetesとは

---

コンテナのオーケストレーションツール(システム全体の統括をし、複数のコンテナを管理できるもの)

- オーケストラと同じ楽団員を指揮者が指揮するように、複数のコンテナを管理するのがKubernetes。
- k8sと略すことも

## Kubernetesは、複数の物理的なマシンに複数のコンテナがあることが前提

- 1台1台の物理的なマシンの中に、複数のコンテナがある
    
    (物理的なマシンは、仮想マシンで構成することもある)
    
    - 複数のコンテナを1台ずつ作成したり、管理したりするのは大変なため、Kubernetesがある
    - 例えば 20個のコンテナを作ろうと思ったら、20回docker runコマンドを使用することになる

# マスターノードとワーカーノード

---

- Kubernetesはマスターノードと呼ばれるコントロールを司るノードとワーカーノードという実際に動かすノードで構成される
- ノードはおおよそ物理的なマシンと同じだと考える
    
    → クラスターの作り方によっては、物理的マシンではないこともある
    

## マスターノード

- ワーカーノード上のコンテナを管理する
    
    (現場監督のようなもので、大工で言えば棟梁に当たる。)
    
- マスターノード上ではコンテナは動かないため、Docker Engineなどのコンテナエンジンもインストールしない

## ワーカーノード

- 実際のサーバーに当たる部分でコンテナが動作するマシン。
- Docker Engineなどのコンテナエンジンもインストールされている必要がある

## クラスター

- マスターとワーカーで構成されたKubernetesのシステムの一群をクラスターと呼ぶ
- クラスターは自立して動くため、管理者のパソコンから直接ワーカーノードを管理することはない。
    
    → 管理者(人)はマスターノードの初期設定・調整のみ行う
    

p234

Kubernetesは、Docker Engineなどのコンテナエンジンとは別のソフトウェア

マスターノードとワーカーノード共通してインストールするもの

- Kubernetesのソフトウェア
- CNI

マスターノードのみ

- コンテナ管理のためのetcdというDBを入れる

ワーカーノードのみ

- Docker Engineなどのコンテナエンジンを入れる

管理者のPC

マスターノードの設定を行うのに、kubectl(クーべコントロール)を入れる

p235

マスターノードは、コントロールプレーン(制御盤)でワーカーノードを管理する

コントロールプレーンは5つの部品で管理されている

etcdとkubernetesを入れれば、すべて入る

ワーカーノードは、kube-letとkube-proxyが動く。kube-letは、マスターノード側のkube-schedulerと連携して、ワーカーノード上にコンテナやボリュームを配置し実行する。Kubernetesを入れればすべて入る

p236

Kubernetesは常に望ましい状態を保つようにする

p238
kubernetesを使ったシステムのコンテナ削除

p240

増減しやすい仕組みのことをスケーラビリティと呼ぶ

etcdの役割。定義ファイルは、etcdに書き込まれる

p241 Kubernetesの構成と用語

Pod

- コンテナとボリュームがセットになったもの
    - 基本的に1Pod 1コンテナだが、コンテナは複数にすることもできる
    - Podの中で複数のコンテナを作成した場合に、共通のボリュームを作成することはある。ボリュームを作らないこともある

Podを束ねるサービス

- Kubernetesのサービスは、Podをまとめて管理するものを指す
    - Podを束ねる班長のようなもの
    - Podが複数のワーカーノード(マシン)に存在している場合でも、まとめて管理する
- ロードバランサーの役割を果たしている
    - サービス一つ一つに固有のIPアドレスが付与されており、通信をPodへ適切に振り分ける
    - 各々のワーカーノードへの振り分けは、本物のロードバランサーで行われる

デプロイメントとレプリカセット

レプリカセット

- Podの数を管理する班長
    - Podが障害で一部停止してしまった場合に、足りない文を増やしたりする
- レプリカセットにより管理されている同一構成のPodをレプリカと呼ぶ
    - Podを増減することを、レプリカを増やす・減らすと言ったり、Podの数を決めることをレプリカの数を決めるとも言ったりする

デプロイメント

- Podのデプロイを管理するもの、どのイメージを使うかなど

p245

リソース

p246

Kubernetesの用語まとめ